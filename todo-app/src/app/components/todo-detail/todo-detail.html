<div class="todo-detail-container">
  <div class="header">
    <button class="back-button" (click)="goBack()">‚Üê Back to List</button>
    <h1>{{ isNewTodo ? 'New Todo' : 'Todo Details' }}</h1>
  </div>

  @if (todo$ | async; as todo) {
    <div class="todo-content">
      <!-- View Mode -->
      @if (!isEditing) {
        <div class="view-mode">
      <div class="todo-info">
        <h2>{{ todo.title }}</h2>
        <p class="description">{{ todo.description }}</p>
        <div class="metadata">
          <p><strong>Created:</strong> {{ todo.creationDate | date:'full' }}</p>
          <p><strong>Status:</strong> <span [class]="'status-' + todo.status">{{ todo.status | titlecase }}</span></p>
        </div>
      </div>
      
      <div class="actions">
        <button class="edit-button" (click)="startEditing()">Edit Todo</button>
        <button class="delete-button" (click)="deleteTodo()">Delete Todo</button>
      </div>
        </div>
      }

      <!-- Edit Mode -->
      @if (isEditing) {
        <div class="edit-mode">
      <form (ngSubmit)="saveTodo()" #todoForm="ngForm">
        <div class="form-group">
          <label for="title">Title:</label>
          <input 
            type="text" 
            id="title" 
            name="title"
            [(ngModel)]="editForm.title" 
            required
            maxlength="100"
            #titleInput="ngModel"
          >
          @if (titleInput.invalid && titleInput.touched) {
            <div class="error-message">
              Title is required
            </div>
          }
        </div>

        <div class="form-group">
          <label for="description">Description:</label>
          <textarea 
            id="description" 
            name="description"
            [(ngModel)]="editForm.description" 
            required
            maxlength="500"
            rows="4"
            #descriptionInput="ngModel"
          ></textarea>
          @if (descriptionInput.invalid && descriptionInput.touched) {
            <div class="error-message">
              Description is required
            </div>
          }
        </div>

        @if (!isNewTodo) {
          <div class="form-group">
          <label for="status">Status:</label>
          <select id="status" name="status" [(ngModel)]="editForm.status">
            <option value="open">Open</option>
            <option value="done">Done</option>
          </select>
          </div>
        }

        <div class="form-actions">
          <button 
            type="submit" 
            class="save-button"
            [disabled]="!isFormValid()"
          >
            {{ isNewTodo ? 'Create Todo' : 'Save Changes' }}
          </button>
          <button type="button" class="cancel-button" (click)="cancelEditing()">
            Cancel
          </button>
        </div>
      </form>
        </div>
      }
    </div>
  } @else {
    <div class="edit-mode">
      <form (ngSubmit)="saveTodo()" #todoForm="ngForm">
        <div class="form-group">
          <label for="title">Title:</label>
          <input 
            type="text" 
            id="title" 
            name="title"
            [(ngModel)]="editForm.title" 
            required
            maxlength="100"
            #titleInput="ngModel"
            placeholder="Enter todo title..."
          >
          @if (titleInput.invalid && titleInput.touched) {
            <div class="error-message">
              Title is required
            </div>
          }
        </div>

        <div class="form-group">
          <label for="description">Description:</label>
          <textarea 
            id="description" 
            name="description"
            [(ngModel)]="editForm.description" 
            required
            maxlength="500"
            rows="4"
            #descriptionInput="ngModel"
            placeholder="Enter todo description..."
          ></textarea>
          @if (descriptionInput.invalid && descriptionInput.touched) {
            <div class="error-message">
              Description is required
            </div>
          }
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="save-button"
            [disabled]="!isFormValid()"
          >
            Create Todo
          </button>
          <button type="button" class="cancel-button" (click)="cancelEditing()">
            Cancel
          </button>
        </div>
      </form>
    </div>
  }
</div>
